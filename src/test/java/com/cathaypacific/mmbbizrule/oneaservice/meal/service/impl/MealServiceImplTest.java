package com.cathaypacific.mmbbizrule.oneaservice.meal.service.impl;

import static org.junit.Assert.assertEquals;
import static org.mockito.Matchers.anyObject;
import static org.mockito.Mockito.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.runners.MockitoJUnitRunner;

import com.cathaypacific.mbcommon.constants.MMBConstants;
import com.cathaypacific.mbcommon.exception.BusinessBaseException;
import com.cathaypacific.mbcommon.exception.ExpectedException;
import com.cathaypacific.mbcommon.exception.SoapFaultException;
import com.cathaypacific.mmbbizrule.config.BizRuleConfig;
import com.cathaypacific.mmbbizrule.db.dao.StatusManagementDAO;
import com.cathaypacific.mmbbizrule.db.dao.TbSsrTypeDAO;
import com.cathaypacific.mmbbizrule.dto.request.meal.addMeal.AddMealDetailDTO;
import com.cathaypacific.mmbbizrule.dto.request.meal.cancelMeal.CancelMealDetailDTO;
import com.cathaypacific.mmbbizrule.oneaservice.handler.OneAErrorHandler;
import com.cathaypacific.mmbbizrule.oneaservice.meal.MealRequestBuilder;
import com.cathaypacific.mmbbizrule.oneaservice.meal.service.MealDTOService;
import com.cathaypacific.mmbbizrule.oneaservice.pnr.PnrResponseParser;
import com.cathaypacific.mmbbizrule.oneaservice.pnr.model.RetrievePnrBooking;
import com.cathaypacific.mmbbizrule.oneaservice.pnr.model.RetrievePnrPassengerSegment;
import com.cathaypacific.mmbbizrule.oneaservice.pnrcancel.service.DeletePnrService;
import com.cathaypacific.oneaconsumer.constant.onea.OneAActionEnum;
import com.cathaypacific.oneaconsumer.model.response.OneaResponse;
import com.cathaypacific.oneaconsumer.model.response.pnracc_16_1_1a.PNRReply;
import com.cathaypacific.oneaconsumer.webservice.service.client.OneAWSClient;
import com.google.common.collect.Lists;
import com.google.gson.Gson;

@RunWith(MockitoJUnitRunner.class)
public class MealServiceImplTest {

	@InjectMocks
	private MealServiceImpl mealServiceImpl;
	
	@Mock
	private OneAWSClient oneAWSClient;
	@Mock
	private BizRuleConfig bizRuleConfig;
	@Mock
	private TbSsrTypeDAO tbSsrTypeDAO;
	@Mock
	private DeletePnrService deletePnrService;
	@Mock
	private MealRequestBuilder mealRequestBuilder;
	@Mock
	private MealDTOService mealDTOServiceImpl;
	@Mock
	private OneAErrorHandler oneAErrorHandler;
	@Mock
	private StatusManagementDAO statusManagementDAO;
	@Mock
	private PnrResponseParser pnrResponseParser;
	
	private static final Gson GSON = new Gson();
	private String pnrJSONMock;
	private PNRReply pnrReplyMock;
	private RetrievePnrBooking retrievePnrBookingMock;
	
	private String expectedPnrJSONMock;
	private RetrievePnrBooking expectedRetrievePnrBookingMock;
	
	
	
	@Before
	public void before() throws Exception{
		OneaResponse<PNRReply> pnrReplyResponseMock = new OneaResponse<>();
		pnrJSONMock = "{\"pnrHeader\":[{\"reservationInfo\":{\"reservation\":[{\"companyId\":\"1A\",\"controlNumber\":\"VSB55D\",\"date\":\"280218\",\"time\":230}]}},{\"reservationInfo\":{\"reservation\":[{\"companyId\":\"1A\",\"controlNumber\":\"VS2PXN\",\"controlType\":\"F\"}]},\"referenceForRecordLocator\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"1\"}]}}],\"securityInformation\":{\"responsibilityInformation\":{\"typeOfPnrElement\":\"RP\",\"agentId\":\"WSSU\",\"officeId\":\"HKGCX0300\",\"iataCode\":\"77491982\"},\"queueingInformation\":{\"queueingOfficeId\":\"HKGCX0300\"},\"cityCode\":\"HKG\",\"secondRpInformation\":{\"creationOfficeId\":\"HKGCX0300\",\"agentSignature\":\"0186WI\",\"creationDate\":\"130218\",\"creatorIataCode\":\"77491982\",\"creationTime\":\"0527\"}},\"freetextData\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P12\"},\"longFreetext\":\"--- TST RLR RLP ---\"}],\"pnrHeaderTag\":{\"statusInformation\":[{\"indicator\":\"TST\"},{\"indicator\":\"RLR\"},{\"indicator\":\"RLP\"}]},\"sbrPOSDetails\":{\"sbrUserIdentificationOwn\":{\"originIdentification\":{\"originatorId\":77491982,\"inHouseIdentification1\":\"HKGCX0300\"},\"originatorTypeCode\":\"A\"},\"sbrSystemDetails\":{\"deliveringSystem\":{\"companyId\":\"CX\",\"locationId\":\"HKG\"}},\"sbrPreferences\":{\"userPreferences\":{\"codedCountry\":\"HK\"}}},\"sbrCreationPosDetails\":{\"sbrUserIdentificationOwn\":{\"originIdentification\":{\"originatorId\":77491982,\"inHouseIdentification1\":\"HKGCX0300\"},\"originatorTypeCode\":\"A\"},\"sbrSystemDetails\":{\"deliveringSystem\":{\"companyId\":\"CX\",\"locationId\":\"HKG\"}},\"sbrPreferences\":{\"userPreferences\":{\"codedCountry\":\"HK\"}}},\"sbrUpdatorPosDetails\":{\"sbrUserIdentificationOwn\":{\"originIdentification\":{\"inHouseIdentification1\":\"HKGCX00WE\"},\"originatorTypeCode\":\"A\"},\"sbrSystemDetails\":{\"deliveringSystem\":{\"companyId\":\"CX\",\"locationId\":\"HKG\"}},\"sbrPreferences\":{\"userPreferences\":{\"codedCountry\":\"HK\"}}},\"technicalData\":{\"enveloppeNumberData\":{\"sequenceDetails\":{\"number\":\"290\"}},\"lastTransmittedEnvelopeNumber\":{\"currentRecord\":289},\"purgeDateData\":{\"dateTime\":{\"year\":2018,\"month\":\"5\",\"day\":\"17\"}}},\"travellerInfo\":[{\"elementManagementPassenger\":{\"reference\":{\"qualifier\":\"PT\",\"number\":4},\"segmentName\":\"NM\",\"lineNumber\":1},\"passengerData\":[{\"travellerInformation\":{\"traveller\":{\"surname\":\"CHIU\",\"quantity\":1},\"passenger\":[{\"firstName\":\"TOM MR\"}]}}],\"enhancedPassengerData\":[{\"enhancedTravellerInformation\":{\"travellerNameInfo\":{\"quantity\":1},\"otherPaxNamesDetails\":[{\"nameType\":\"UN\",\"referenceName\":\"Y\",\"displayedName\":\"Y\",\"surname\":\"CHIU\",\"givenName\":\"TOM MR\"}]}}]},{\"elementManagementPassenger\":{\"reference\":{\"qualifier\":\"PT\",\"number\":2},\"segmentName\":\"NM\",\"lineNumber\":2},\"passengerData\":[{\"travellerInformation\":{\"traveller\":{\"surname\":\"CHIU\",\"quantity\":2},\"passenger\":[{\"firstName\":\"TOMMY\",\"infantIndicator\":\"1\"},{\"firstName\":\"LILY\",\"type\":\"INF\"}]},\"dateOfBirth\":{\"dateAndTimeDetails\":{\"qualifier\":\"706\",\"date\":\"01122016\"}}}],\"enhancedPassengerData\":[{\"enhancedTravellerInformation\":{\"travellerNameInfo\":{\"quantity\":1,\"infantIndicator\":\"1\"},\"otherPaxNamesDetails\":[{\"nameType\":\"UN\",\"referenceName\":\"Y\",\"displayedName\":\"Y\",\"surname\":\"CHIU\",\"givenName\":\"TOMMY\"}]}},{\"enhancedTravellerInformation\":{\"travellerNameInfo\":{\"quantity\":1,\"type\":\"INF\"},\"otherPaxNamesDetails\":[{\"nameType\":\"UN\",\"referenceName\":\"Y\",\"displayedName\":\"Y\",\"surname\":\"CHIU\",\"givenName\":\"LILY\"}]},\"dateOfBirthInEnhancedPaxData\":{\"dateAndTimeDetails\":{\"qualifier\":\"706\",\"date\":\"01122016\"}}}]},{\"elementManagementPassenger\":{\"reference\":{\"qualifier\":\"PT\",\"number\":1},\"segmentName\":\"NM\",\"lineNumber\":3},\"passengerData\":[{\"travellerInformation\":{\"traveller\":{\"surname\":\"TEST\",\"quantity\":1},\"passenger\":[{\"firstName\":\"N LAURENCE MR\"}]}}],\"enhancedPassengerData\":[{\"enhancedTravellerInformation\":{\"travellerNameInfo\":{\"quantity\":1},\"otherPaxNamesDetails\":[{\"nameType\":\"UN\",\"referenceName\":\"Y\",\"displayedName\":\"Y\",\"surname\":\"TEST\",\"givenName\":\"N LAURENCE MR\"}]}}]}],\"originDestinationDetails\":[{\"originDestination\":{},\"itineraryInfo\":[{\"elementManagementItinerary\":{\"reference\":{\"qualifier\":\"ST\",\"number\":1},\"segmentName\":\"AIR\",\"lineNumber\":4},\"travelProduct\":{\"product\":{\"depDate\":\"120518\",\"depTime\":\"1000\",\"arrDate\":\"120518\",\"arrTime\":\"1155\"},\"boardpointDetail\":{\"cityCode\":\"HKG\"},\"offpointDetail\":{\"cityCode\":\"TPE\"},\"companyDetail\":{\"identification\":\"CX\"},\"productDetails\":{\"identification\":\"450\",\"classOfService\":\"Y\"},\"typeDetail\":{\"detail\":\"ET\"}},\"itineraryMessageAction\":{\"business\":{\"function\":\"1\"}},\"itineraryReservationInfo\":{\"reservation\":{\"companyId\":\"CX\",\"controlNumber\":\"VSB55D\"}},\"relatedProduct\":{\"quantity\":3,\"status\":[\"HK\"]},\"flightDetail\":{\"productDetails\":{\"equipment\":\"773\",\"numOfStops\":0,\"weekDay\":6},\"departureInformation\":{\"departTerminal\":\"1\"},\"arrivalStationInfo\":{\"terminal\":\"1\"},\"facilities\":[{\"entertainement\":\"M\",\"entertainementDescription\":\"R\"}]},\"selectionDetails\":{\"selection\":[{\"option\":\"P2\"}]},\"carbonDioxydeInfo\":{\"carbonDioxydeAmount\":{\"quantityDetails\":{\"qualifier\":\"COE\",\"value\":74.698378,\"unit\":\"KPP\"}},\"carbonDioxydeInfoSource\":{\"freeTextDetails\":{\"textSubjectQualifier\":\"3\",\"source\":\"S\",\"encoding\":\"7\"},\"freeText\":[\"SOURCE:ICAO CARBON EMISSIONS CALCULATOR\"]}},\"markerRailTour\":{}},{\"elementManagementItinerary\":{\"reference\":{\"qualifier\":\"ST\",\"number\":2},\"segmentName\":\"AIR\",\"lineNumber\":5},\"travelProduct\":{\"product\":{\"depDate\":\"130518\",\"depTime\":\"2110\",\"arrDate\":\"130518\",\"arrTime\":\"2255\"},\"boardpointDetail\":{\"cityCode\":\"TPE\"},\"offpointDetail\":{\"cityCode\":\"HKG\"},\"companyDetail\":{\"identification\":\"KA\"},\"productDetails\":{\"identification\":\"483\",\"classOfService\":\"Y\"},\"typeDetail\":{\"detail\":\"ET\"}},\"itineraryMessageAction\":{\"business\":{\"function\":\"1\"}},\"itineraryReservationInfo\":{\"reservation\":{\"companyId\":\"KA\",\"controlNumber\":\"VSB55D\"}},\"relatedProduct\":{\"quantity\":3,\"status\":[\"HK\"]},\"flightDetail\":{\"productDetails\":{\"equipment\":\"333\",\"numOfStops\":0,\"weekDay\":7},\"departureInformation\":{\"departTerminal\":\"1\"},\"arrivalStationInfo\":{\"terminal\":\"1\"},\"facilities\":[{\"entertainement\":\"M\",\"entertainementDescription\":\"D\"}]},\"selectionDetails\":{\"selection\":[{\"option\":\"P2\"}]},\"carbonDioxydeInfo\":{\"carbonDioxydeAmount\":{\"quantityDetails\":{\"qualifier\":\"COE\",\"value\":74.695446,\"unit\":\"KPP\"}},\"carbonDioxydeInfoSource\":{\"freeTextDetails\":{\"textSubjectQualifier\":\"3\",\"source\":\"S\",\"encoding\":\"7\"},\"freeText\":[\"SOURCE:ICAO CARBON EMISSIONS CALCULATOR\"]}},\"markerRailTour\":{}}]}],\"dataElementsMaster\":{\"marker2\":{},\"dataElementsIndiv\":[{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":10},\"segmentName\":\"AP\",\"lineNumber\":6},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P02\"},\"longFreetext\":\"DSFSDF@SDFS.COM\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"1\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":13},\"segmentName\":\"AP\",\"lineNumber\":7},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P02\"},\"longFreetext\":\"CPPJOTS@CATHAYPACIFIC.COM\"}]},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":12},\"segmentName\":\"AP\",\"lineNumber\":8},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"7\"},\"longFreetext\":\"+85123456\"}]},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":25},\"segmentName\":\"TK\",\"lineNumber\":9},\"ticketElement\":{\"passengerType\":\"PAX\",\"ticket\":{\"indicator\":\"OK\",\"date\":\"130218\",\"officeId\":\"HKGCX0300\",\"electronicTicketFlag\":\"ET\",\"airlineCode\":\"CX\"}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":26},\"segmentName\":\"TK\",\"lineNumber\":10},\"ticketElement\":{\"ticket\":{\"indicator\":\"OK\",\"date\":\"130218\",\"officeId\":\"HKGCX0300\",\"electronicTicketFlag\":\"ET\",\"airlineCode\":\"CX\"}}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":43},\"segmentName\":\"SSR\",\"lineNumber\":11},\"serviceRequest\":{\"ssr\":{\"type\":\"RQST\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\",\"boardpoint\":\"HKG\",\"offpoint\":\"TPE\"},\"ssrb\":[{\"data\":\"41K\",\"crossRef\":\"4\",\"seatType\":[\"N\"]}]},\"seatPaxInfo\":[{\"seatPaxDetails\":{\"genericDetails\":{\"seatCharacteristic\":[\"N\",\"W\"]}},\"crossRef\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"4\"}]}}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":50},\"segmentName\":\"SSR\",\"lineNumber\":14},\"serviceRequest\":{\"ssr\":{\"type\":\"RQST\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"KA\",\"boardpoint\":\"TPE\",\"offpoint\":\"HKG\"},\"ssrb\":[{\"data\":\"22D\",\"crossRef\":\"1\",\"seatType\":[\"N\"]}]},\"seatPaxInfo\":[{\"seatPaxDetails\":{\"genericDetails\":{\"seatCharacteristic\":[\"N\",\"K\",\"A\"]}},\"crossRef\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"1\"}]}}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"1\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":622},\"segmentName\":\"SSR\",\"lineNumber\":12},\"serviceRequest\":{\"ssr\":{\"type\":\"RQST\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\",\"boardpoint\":\"HKG\",\"offpoint\":\"TPE\"},\"ssrb\":[{\"data\":\"40D\",\"crossRef\":\"1\",\"seatType\":[\"N\"]}]},\"seatPaxInfo\":[{\"seatPaxDetails\":{\"genericDetails\":{\"seatCharacteristic\":[\"N\",\"A\"]}},\"crossRef\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"1\"}]}}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"1\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":625},\"segmentName\":\"SSR\",\"lineNumber\":13},\"serviceRequest\":{\"ssr\":{\"type\":\"RQST\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\",\"boardpoint\":\"HKG\",\"offpoint\":\"TPE\"},\"ssrb\":[{\"data\":\"40E\",\"crossRef\":\"2\",\"seatType\":[\"N\"]}]},\"seatPaxInfo\":[{\"seatPaxDetails\":{\"genericDetails\":{\"seatCharacteristic\":[\"N\"]}},\"crossRef\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"2\"}]}}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":7},\"segmentName\":\"SSR\",\"lineNumber\":15},\"serviceRequest\":{\"ssr\":{\"type\":\"INFT\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\",\"freeText\":[\"CHIU/LILY 01DEC16\"]}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":8},\"segmentName\":\"SSR\",\"lineNumber\":16},\"serviceRequest\":{\"ssr\":{\"type\":\"INFT\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"KA\",\"freeText\":[\"CHIU/LILY 01DEC16\"]}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":9},\"segmentName\":\"SSR\",\"lineNumber\":17},\"serviceRequest\":{\"ssr\":{\"type\":\"FQTV\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\",\"indicator\":\"P02\"}},\"frequentFlyerInformationGroup\":{\"frequentTravellerInfo\":{\"frequentTraveler\":{\"company\":\"CX\",\"membershipNumber\":\"1910032120\"},\"priorityDetails\":[{\"qualifier\":\"1\",\"priorityCode\":\"3\",\"tierLevel\":\"GO\"},{\"qualifier\":\"2\",\"priorityCode\":\"2\",\"tierLevel\":\"SAPP\",\"tierDescription\":\"SAPPHIRE\"}]}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"1\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":38},\"segmentName\":\"SSR\",\"lineNumber\":18},\"serviceRequest\":{\"ssr\":{\"type\":\"MEDA\",\"status\":\" \",\"companyId\":\"CX\"}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":680},\"segmentName\":\"SSR\",\"lineNumber\":19},\"serviceRequest\":{\"ssr\":{\"type\":\"LCML\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\"}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":681},\"segmentName\":\"SSR\",\"lineNumber\":20},\"serviceRequest\":{\"ssr\":{\"type\":\"LCML\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\"}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"1\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":682},\"segmentName\":\"SSR\",\"lineNumber\":21},\"serviceRequest\":{\"ssr\":{\"type\":\"BBML\",\"status\":\"HK\",\"quantity\":1,\"companyId\":\"CX\"}},\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":27},\"segmentName\":\"FA\",\"lineNumber\":22},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P06\"},\"longFreetext\":\"PAX 160-2361895962/ETCX/HKD5656/13FEB18/HKGCX0300/77491982\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":28},\"segmentName\":\"FA\",\"lineNumber\":23},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P06\"},\"longFreetext\":\"PAX 160-2361895963/ETCX/HKD5656/13FEB18/HKGCX0300/77491982\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":29},\"segmentName\":\"FA\",\"lineNumber\":24},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P06\"},\"longFreetext\":\"PAX 160-2361895964/ETCX/HKD5656/13FEB18/HKGCX0300/77491982\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"1\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":30},\"segmentName\":\"FA\",\"lineNumber\":25},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P06\"},\"longFreetext\":\"INF 160-2361895965/ETCX/HKD665/13FEB18/HKGCX0300/77491982\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":23},\"segmentName\":\"FB\",\"lineNumber\":26},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P07\"},\"longFreetext\":\"PAX 0000000000 TTP/RT OK ETICKET\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":24},\"segmentName\":\"FB\",\"lineNumber\":27},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P07\"},\"longFreetext\":\"INF 0000000001 TTP/RT OK ETICKET\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":57},\"segmentName\":\"FE\",\"lineNumber\":28},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"10\"},\"longFreetext\":\"PAX T1\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":59},\"segmentName\":\"FE\",\"lineNumber\":29},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"10\"},\"longFreetext\":\"INF T1\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":15},\"segmentName\":\"FP\",\"lineNumber\":30},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"16\"},\"longFreetext\":\"CASH\"}]},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":58},\"segmentName\":\"FV\",\"lineNumber\":31},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P18\"},\"longFreetext\":\"PAX CX\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"4\"}]}},{\"elementManagementData\":{\"reference\":{\"qualifier\":\"OT\",\"number\":60},\"segmentName\":\"FV\",\"lineNumber\":32},\"otherDataFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"P18\"},\"longFreetext\":\"INF CX\"}],\"referenceForDataElement\":{\"reference\":[{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"2\"}]}}]},\"tstData\":[{\"tstGeneralInformation\":{\"generalInformation\":{\"tstReferenceNumber\":\"9\",\"tstCreationDate\":\"130218\"}},\"tstFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"41\"},\"longFreetext\":\"PAX\"},{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"37\"},\"longFreetext\":\"HKG CX TPE338.05KA HKG338.05NUC676.10END ROE7.794690\"}],\"fareBasisInfo\":{\"fareElement\":[{\"primaryCode\":\"YRT\",\"baggageAllowance\":\"30K\"},{\"primaryCode\":\"YRT\",\"connection\":\"O\",\"baggageAllowance\":\"30K\"}]},\"fareData\":{\"issueIdentifier\":\"F\",\"monetaryInfo\":[{\"qualifier\":\"F\",\"amount\":\"5270\",\"currencyCode\":\"HKD\"},{\"qualifier\":\"T\",\"amount\":\"5656\",\"currencyCode\":\"HKD\"}],\"taxFields\":[{\"taxIndicator\":\"X\",\"taxCurrency\":\"HKD\",\"taxAmount\":\"120\",\"taxCountryCode\":\"HK\",\"taxNatureCode\":\"AE\"},{\"taxIndicator\":\"X\",\"taxCurrency\":\"HKD\",\"taxAmount\":\"90\",\"taxCountryCode\":\"G3\",\"taxNatureCode\":\"RE\"},{\"taxIndicator\":\"X\",\"taxCurrency\":\"HKD\",\"taxAmount\":\"45\",\"taxCountryCode\":\"I5\",\"taxNatureCode\":\"SE\"},{\"taxIndicator\":\"X\",\"taxCurrency\":\"HKD\",\"taxAmount\":\"131\",\"taxCountryCode\":\"TW\",\"taxNatureCode\":\"AE\"}]},\"segmentAssociation\":{\"selection\":[{\"option\":\"N\"},{\"option\":\"I\"}]},\"referenceForTstData\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"1\"},{\"qualifier\":\"PT\",\"number\":\"2\"},{\"qualifier\":\"PT\",\"number\":\"4\"},{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"}]}},{\"tstGeneralInformation\":{\"generalInformation\":{\"tstReferenceNumber\":\"10\",\"tstCreationDate\":\"130218\"}},\"tstFreetext\":[{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"41\"},\"longFreetext\":\"INF\"},{\"freetextDetail\":{\"subjectQualifier\":\"3\",\"type\":\"37\"},\"longFreetext\":\"HKG CX TPE33.80KA HKG33.80NUC67.60END ROE7.794690\"}],\"fareBasisInfo\":{\"fareElement\":[{\"primaryCode\":\"YRT\",\"baggageAllowance\":\"10K\",\"ticketDesignator\":\"IN90\"},{\"primaryCode\":\"YRT\",\"connection\":\"O\",\"baggageAllowance\":\"10K\",\"ticketDesignator\":\"IN90\"}]},\"fareData\":{\"issueIdentifier\":\"F\",\"monetaryInfo\":[{\"qualifier\":\"F\",\"amount\":\"530\",\"currencyCode\":\"HKD\"},{\"qualifier\":\"T\",\"amount\":\"665\",\"currencyCode\":\"HKD\"}],\"taxFields\":[{\"taxIndicator\":\"X\",\"taxCurrency\":\"HKD\",\"taxAmount\":\"90\",\"taxCountryCode\":\"G3\",\"taxNatureCode\":\"RE\"},{\"taxIndicator\":\"X\",\"taxCurrency\":\"HKD\",\"taxAmount\":\"45\",\"taxCountryCode\":\"I5\",\"taxNatureCode\":\"SE\"}]},\"segmentAssociation\":{\"selection\":[{\"option\":\"N\"},{\"option\":\"I\"}]},\"referenceForTstData\":{\"reference\":[{\"qualifier\":\"PT\",\"number\":\"2\"},{\"qualifier\":\"ST\",\"number\":\"1\"},{\"qualifier\":\"ST\",\"number\":\"2\"}]}}],\"pricingRecordGroup\":{\"pricingRecordData\":{},\"productPricingQuotationRecord\":[{\"pricingRecordId\":{\"referenceType\":\"TST\",\"uniqueReference\":\"9\"},\"passengerTattoos\":[{\"passengerReference\":{\"type\":\"PA\",\"value\":\"1\"}},{\"passengerReference\":{\"type\":\"PA\",\"value\":\"2\"}},{\"passengerReference\":{\"type\":\"PA\",\"value\":\"4\"}}],\"documentDetailsGroup\":{\"totalFare\":{\"monetaryDetails\":{\"typeQualifier\":\"T\",\"amount\":\"5656\",\"currency\":\"HKD\"}},\"issueIdentifier\":{\"priceTicketDetails\":{\"indicators\":\"I\"},\"priceTariffType\":\"F\"},\"manualIndicator\":{\"statusDetails\":{\"indicator\":\"M\",\"action\":\"N\"}},\"officeInformation\":{\"originIdentification\":{\"inHouseIdentification1\":\"HKGCX0300\",\"inHouseIdentification2\":\"WI\"}},\"creationDate\":{\"businessSemantic\":\"CRD\",\"dateTime\":{\"year\":\"2018\",\"month\":\"02\",\"day\":\"13\"}},\"couponDetailsGroup\":[{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"1\"}}},{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"2\"}}}],\"fareComponentDetailsGroup\":[{\"fareComponentID\":{\"itemNumberDetails\":[{\"number\":\"1\",\"type\":\"FAR\"}]},\"marketFareComponent\":{\"boardPointDetails\":{\"trueLocationId\":\"HKG\"},\"offpointDetails\":{\"trueLocationId\":\"TPE\"}},\"monetaryInformation\":{\"monetaryDetails\":{\"typeQualifier\":\"B\",\"amount\":\"338.05\",\"currency\":\"NUC\"}},\"componentClassInfo\":{\"fareBasisDetails\":{\"rateTariffClass\":\"YRT\"}},\"fareQualifiersDetail\":{\"discountDetails\":[{\"fareQualifier\":\"763\"}]},\"couponDetailsGroup\":[{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"1\"}}}]},{\"fareComponentID\":{\"itemNumberDetails\":[{\"number\":\"2\",\"type\":\"FAR\"}]},\"marketFareComponent\":{\"boardPointDetails\":{\"trueLocationId\":\"TPE\"},\"offpointDetails\":{\"trueLocationId\":\"HKG\"}},\"monetaryInformation\":{\"monetaryDetails\":{\"typeQualifier\":\"B\",\"amount\":\"338.05\",\"currency\":\"NUC\"}},\"componentClassInfo\":{\"fareBasisDetails\":{\"rateTariffClass\":\"YRT\"}},\"fareQualifiersDetail\":{\"discountDetails\":[{\"fareQualifier\":\"763\"}]},\"couponDetailsGroup\":[{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"2\"}}}]}]}},{\"pricingRecordId\":{\"referenceType\":\"TST\",\"uniqueReference\":\"10\"},\"passengerTattoos\":[{\"passengerReference\":{\"type\":\"PI\",\"value\":\"2\"}}],\"documentDetailsGroup\":{\"totalFare\":{\"monetaryDetails\":{\"typeQualifier\":\"T\",\"amount\":\"665\",\"currency\":\"HKD\"}},\"issueIdentifier\":{\"priceTicketDetails\":{\"indicators\":\"I\"},\"priceTariffType\":\"F\"},\"manualIndicator\":{\"statusDetails\":{\"indicator\":\"M\",\"action\":\"N\"}},\"officeInformation\":{\"originIdentification\":{\"inHouseIdentification1\":\"HKGCX0300\",\"inHouseIdentification2\":\"WI\"}},\"creationDate\":{\"businessSemantic\":\"CRD\",\"dateTime\":{\"year\":\"2018\",\"month\":\"02\",\"day\":\"13\"}},\"couponDetailsGroup\":[{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"1\"}}},{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"2\"}}}],\"fareComponentDetailsGroup\":[{\"fareComponentID\":{\"itemNumberDetails\":[{\"number\":\"1\",\"type\":\"FAR\"}]},\"marketFareComponent\":{\"boardPointDetails\":{\"trueLocationId\":\"HKG\"},\"offpointDetails\":{\"trueLocationId\":\"TPE\"}},\"monetaryInformation\":{\"monetaryDetails\":{\"typeQualifier\":\"B\",\"amount\":\"33.80\",\"currency\":\"NUC\"}},\"componentClassInfo\":{\"fareBasisDetails\":{\"rateTariffClass\":\"YRT\",\"otherRateTariffClass\":\"IN90\"}},\"fareQualifiersDetail\":{\"discountDetails\":[{\"fareQualifier\":\"763\"}]},\"couponDetailsGroup\":[{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"1\"}}}]},{\"fareComponentID\":{\"itemNumberDetails\":[{\"number\":\"2\",\"type\":\"FAR\"}]},\"marketFareComponent\":{\"boardPointDetails\":{\"trueLocationId\":\"TPE\"},\"offpointDetails\":{\"trueLocationId\":\"HKG\"}},\"monetaryInformation\":{\"monetaryDetails\":{\"typeQualifier\":\"B\",\"amount\":\"33.80\",\"currency\":\"NUC\"}},\"componentClassInfo\":{\"fareBasisDetails\":{\"rateTariffClass\":\"YRT\",\"otherRateTariffClass\":\"IN90\"}},\"fareQualifiersDetail\":{\"discountDetails\":[{\"fareQualifier\":\"763\"}]},\"couponDetailsGroup\":[{\"productId\":{\"referenceDetails\":{\"type\":\"ST\",\"value\":\"2\"}}}]}]}}]}}";
		pnrReplyMock = GSON.fromJson(pnrJSONMock, PNRReply.class);
		pnrReplyResponseMock.setBody(pnrReplyMock);
		
		expectedPnrJSONMock = "{\"rloc\":\"VSB55D\",\"passengers\":[{\"passengerID\":\"4\",\"passengerType\":\"ADT\",\"familyName\":\"CHIU\",\"givenName\":\"TOM MR\",\"priTravelDocs\":[],\"secTravelDocs\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"passengerID\":\"2I\",\"parentId\":\"2\",\"passengerType\":\"INF\",\"familyName\":\"CHIU\",\"givenName\":\"LILY\",\"priTravelDocs\":[],\"secTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[]},{\"passengerID\":\"2\",\"passengerType\":\"ADT\",\"familyName\":\"CHIU\",\"givenName\":\"TOMMY\",\"priTravelDocs\":[],\"secTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"passengerID\":\"1\",\"passengerType\":\"ADT\",\"familyName\":\"TEST\",\"givenName\":\"N LAURENCE MR\",\"FQTVInfos\":[{\"companyId\":\"CX\",\"fqtvCompany\":\"CX\",\"fqtvMembershipNumber\":\"1910032120\",\"tierLevel\":\"GO\",\"isTopTier\":true,\"qualifierId\":9}],\"priTravelDocs\":[],\"secTravelDocs\":[],\"desAddresses\":[],\"resAddresses\":[]}],\"segments\":[{\"segmentID\":\"1\",\"originPort\":\"HKG\",\"destPort\":\"TPE\",\"DepartureTime\":{\"pnrTime\":\"2018-05-12 10:00\"},\"ArrivalTime\":{\"pnrTime\":\"2018-05-12 11:55\"},\"marketSegmentNumber\":\"450\",\"marketCompany\":\"CX\",\"subClass\":\"Y\",\"status\":[\"HK\"],\"originTerminal\":\"1\",\"destTerminal\":\"1\",\"airCraftType\":\"773\"},{\"segmentID\":\"2\",\"originPort\":\"TPE\",\"destPort\":\"HKG\",\"DepartureTime\":{\"pnrTime\":\"2018-05-13 21:10\"},\"ArrivalTime\":{\"pnrTime\":\"2018-05-13 22:55\"},\"marketSegmentNumber\":\"483\",\"marketCompany\":\"KA\",\"subClass\":\"Y\",\"status\":[\"HK\"],\"originTerminal\":\"1\",\"destTerminal\":\"1\",\"airCraftType\":\"333\"}],\"passengerSegments\":[{\"etickets\":[{\"ticketNumber\":\"1602361895962\"}],\"passengerId\":\"4\",\"segmentId\":\"1\",\"seat\":{\"seatDetail\":{\"seatNo\":\"41K\",\"seatCharacteristics\":[\"N\",\"W\"],\"paid\":false},\"qulifierId\":43},\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895962\"}],\"passengerId\":\"4\",\"segmentId\":\"2\",\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895963\"}],\"passengerId\":\"2\",\"segmentId\":\"1\",\"seat\":{\"seatDetail\":{\"seatNo\":\"40E\",\"seatCharacteristics\":[\"N\"],\"paid\":false},\"qulifierId\":625},\"baggageAllowance\":\"40K\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895963\"}],\"passengerId\":\"2\",\"segmentId\":\"2\",\"baggageAllowance\":\"40K\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895964\"}],\"passengerId\":\"1\",\"segmentId\":\"1\",\"seat\":{\"seatDetail\":{\"seatNo\":\"40D\",\"seatCharacteristics\":[\"N\",\"A\"],\"paid\":false},\"qulifierId\":622},\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895964\"}],\"passengerId\":\"1\",\"segmentId\":\"2\",\"seat\":{\"seatDetail\":{\"seatNo\":\"22D\",\"seatCharacteristics\":[\"N\",\"K\",\"A\"],\"paid\":false},\"qulifierId\":50},\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895965\"}],\"passengerId\":\"2I\",\"segmentId\":\"1\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[]},{\"etickets\":[{\"ticketNumber\":\"1602361895965\"}],\"passengerId\":\"2I\",\"segmentId\":\"2\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[]}],\"ssrList\":[{\"type\":\"RQST\",\"passengerId\":\"4\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"RQST\",\"passengerId\":\"1\",\"segmentId\":\"2\",\"segmentName\":\"SSR\"},{\"type\":\"RQST\",\"passengerId\":\"1\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"RQST\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"INFT\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"INFT\",\"passengerId\":\"2\",\"segmentId\":\"2\",\"segmentName\":\"SSR\"},{\"type\":\"FQTV\",\"passengerId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"MEDA\",\"passengerId\":\"4\",\"segmentName\":\"SSR\"},{\"type\":\"LCML\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"LCML\",\"passengerId\":\"1\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"BBML\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"}],\"ticketList\":[{\"indicator\":\"OK\",\"date\":\"130218\",\"officeId\":\"HKGCX0300\"},{\"indicator\":\"OK\",\"date\":\"130218\",\"officeId\":\"HKGCX0300\"}],\"remarkList\":[]}";
		expectedRetrievePnrBookingMock = GSON.fromJson(expectedPnrJSONMock, RetrievePnrBooking.class);
		
		retrievePnrBookingMock = GSON.fromJson("{\"rloc\": \"VSB55D\",\"passengers\": [{\"passengerID\": \"4\",\"passengerType\": \"ADT\",\"familyName\": \"CHIU\",\"givenName\": \"TOM MR\",\"priTravelDocs\": [],\"secTravelDocs\": [],\"desAddresses\": [],\"resAddresses\": []}, {\"passengerID\": \"2I\",\"parentId\": \"2\",\"passengerType\": \"INF\",\"familyName\": \"CHIU\",\"givenName\": \"LILY\",\"priTravelDocs\": [],\"secTravelDocs\": [],\"othTravelDocs\": [],\"ktns\": [],\"redresses\": []}, {\"passengerID\": \"2\",\"passengerType\": \"ADT\",\"familyName\": \"CHIU\",\"givenName\": \"TOMMY\",\"priTravelDocs\": [],\"secTravelDocs\": [],\"othTravelDocs\": [],\"ktns\": [],\"redresses\": [],\"desAddresses\": [],\"resAddresses\": []}, {\"passengerID\": \"1\",\"passengerType\": \"ADT\",\"familyName\": \"TEST\",\"givenName\": \"N LAURENCE MR\",\"FQTVInfos\": [{\"companyId\": \"CX\",\"fqtvCompany\": \"CX\",\"fqtvMembershipNumber\": \"1910032120\",\"tierLevel\": \"GO\",\"isTopTier\": true,\"qualifierId\": 9}],\"priTravelDocs\": [],\"secTravelDocs\": [],\"desAddresses\": [],\"resAddresses\": []}],\"segments\": [{\"segmentID\": \"1\",\"originPort\": \"HKG\",\"destPort\": \"TPE\",\"DepartureTime\": {\"pnrTime\": \"2018-05-12 10:00\"},\"ArrivalTime\": {\"pnrTime\": \"2018-05-12 11:55\"},\"marketSegmentNumber\": \"450\",\"marketCompany\": \"CX\",\"subClass\": \"Y\",\"status\": [\"HK\"],\"originTerminal\": \"1\",\"destTerminal\": \"1\",\"airCraftType\": \"773\"}, {\"segmentID\": \"2\",\"originPort\": \"TPE\",\"destPort\": \"HKG\",\"DepartureTime\": {\"pnrTime\": \"2018-05-13 21:10\"},\"ArrivalTime\": {\"pnrTime\": \"2018-05-13 22:55\"},\"marketSegmentNumber\": \"483\",\"marketCompany\": \"KA\",\"subClass\": \"Y\",\"status\": [\"HK\"],\"originTerminal\": \"1\",\"destTerminal\": \"1\",\"airCraftType\": \"333\"}],\"passengerSegments\": [{\"etickets\": [{\"ticketNumber\":\"1602361895962\"}],\"passengerId\": \"4\",\"segmentId\": \"1\",\"seat\": {\"seatDetail\": {\"seatNo\": \"41K\",\"seatCharacteristics\": [\"N\", \"W\"],\"paid\": false},\"qulifierId\": 43},\"baggageAllowance\": \"30K\",\"desAddresses\": [],\"resAddresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895962\"}],\"passengerId\": \"4\",\"segmentId\": \"2\",\"baggageAllowance\": \"30K\",\"desAddresses\": [],\"resAddresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895963\"}],\"passengerId\": \"2\",\"segmentId\": \"1\",\"seat\": {\"seatDetail\": {\"seatNo\": \"40E\",\"seatCharacteristics\": [\"N\"],\"paid\": false},\"qulifierId\": 625},\"baggageAllowance\": \"40K\",\"meal\": {\"mealCode\": \"LCML\",\"status\": \"HK\",\"quantity\": 1,\"qulifierId\": \"680\",\"companyId\": \"CX\"},\"PriTravelDocs\": [],\"SecTravelDocs\": [],\"othTravelDocs\": [],\"ktns\": [],\"redresses\": [],\"desAddresses\": [],\"resAddresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895963\"}],\"passengerId\": \"2\",\"segmentId\": \"2\",\"baggageAllowance\": \"40K\",\"PriTravelDocs\": [],\"SecTravelDocs\": [],\"othTravelDocs\": [],\"ktns\": [],\"redresses\": [],\"desAddresses\": [],\"resAddresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895964\"}],\"passengerId\": \"1\",\"segmentId\": \"1\",\"seat\": {\"seatDetail\": {\"seatNo\": \"40D\",\"seatCharacteristics\": [\"N\", \"A\"],\"paid\": false},\"qulifierId\": 622},\"baggageAllowance\": \"30K\",\"meal\": {\"mealCode\": \"LCML\",\"status\": \"HK\",\"quantity\": 1,\"qulifierId\": \"681\",\"companyId\": \"CX\"},\"desAddresses\": [],\"resAddresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895964\"}],\"passengerId\": \"1\",\"segmentId\": \"2\",\"seat\": {\"seatDetail\": {\"seatNo\": \"22D\",\"seatCharacteristics\": [\"N\", \"K\", \"A\"],\"paid\": false},\"qulifierId\": 50},\"baggageAllowance\": \"30K\",\"desAddresses\": [],\"resAddresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895965\"}],\"passengerId\": \"2I\",\"segmentId\": \"1\",\"meal\": {\"mealCode\": \"BBML\",\"status\": \"HK\",\"quantity\": 1,\"qulifierId\": \"682\",\"companyId\": \"CX\"},\"PriTravelDocs\": [],\"SecTravelDocs\": [],\"othTravelDocs\": [],\"ktns\": [],\"redresses\": []}, {\"etickets\": [{\"ticketNumber\":\"1602361895965\"}],\"passengerId\": \"2I\",\"segmentId\": \"2\",\"PriTravelDocs\": [],\"SecTravelDocs\": [],\"othTravelDocs\": [],\"ktns\": [],\"redresses\": []}],\"ssrList\": [{\"type\": \"RQST\",\"passengerId\": \"4\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"RQST\",\"passengerId\": \"1\",\"segmentId\": \"2\",\"segmentName\": \"SSR\"}, {\"type\": \"RQST\",\"passengerId\": \"1\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"RQST\",\"passengerId\": \"2\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"INFT\",\"passengerId\": \"2\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"INFT\",\"passengerId\": \"2\",\"segmentId\": \"2\",\"segmentName\": \"SSR\"}, {\"type\": \"FQTV\",\"passengerId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"MEDA\",\"passengerId\": \"4\",\"segmentName\": \"SSR\"}, {\"type\": \"LCML\",\"passengerId\": \"2\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"LCML\",\"passengerId\": \"1\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}, {\"type\": \"BBML\",\"passengerId\": \"2\",\"segmentId\": \"1\",\"segmentName\": \"SSR\"}],\"ticketList\": [{\"indicator\": \"OK\",\"date\": \"130218\",\"officeId\": \"HKGCX0300\"}, {\"indicator\": \"OK\",\"date\": \"130218\",\"officeId\": \"HKGCX0300\"}],\"remarkList\": []}", RetrievePnrBooking.class);
		
		when(bizRuleConfig.getCxkaTierLevel()).thenReturn(Arrays.asList("IN,DM,DMP,GO,SL,GR".split(",")));
		when(bizRuleConfig.getOneworldTierLevel()).thenReturn(Arrays.asList("RUBY,SAPH,EMER".split(",")));
		when(bizRuleConfig.getTopTier()).thenReturn(Arrays.asList("IN,DM,GO,SL,RUBY,SAPH,EMER".split(",")));
		when(bizRuleConfig.getTdInfantGenders()).thenReturn(Arrays.asList("MI,FI".split(",")));
		when(bizRuleConfig.getTdPrimaryTypes()).thenReturn(Arrays.asList("P".split(",")));
		when(bizRuleConfig.getTdSecondaryTypes()).thenReturn(Arrays.asList("V".split(",")));
		
		when(oneAWSClient.addMultiElements(anyObject(), anyObject())).thenReturn(pnrReplyResponseMock);
		when(tbSsrTypeDAO.findByAppCodeAndTypeAndAction(anyObject(), anyObject(), anyObject())).thenReturn(Lists.newArrayList());
		when(tbSsrTypeDAO.findByAppCodeAndType(anyObject(), anyObject())).thenReturn(Lists.newArrayList());
		when(deletePnrService.deletePnr(anyObject(), anyObject(), anyObject())).thenReturn(expectedRetrievePnrBookingMock);
		when(mealRequestBuilder.buildRequest(anyObject(), anyObject(), anyObject())).thenReturn(null);
		when(statusManagementDAO.findByAppCode(MMBConstants.APP_CODE)).thenReturn(new ArrayList<>());
		
	}
	
//	@Test
//	public void testCancelMealNormalFlow() throws ExpectedException, SoapFaultException, BusinessBaseException{
//		CancelMealDetailDTO cancelMealRequestDTO = GSON.fromJson("{\"paxIds\":[\"2I\"],\"rloc\":\"VSB55D\",\"segmentId\":\"1\"}", CancelMealDetailDTO.class);
//		List<CancelMealDetailDTO> cancelMealRequestDTOs = Lists.newArrayList(cancelMealRequestDTO);
//		RetrievePnrBooking actualRetrievePnrBooking = (RetrievePnrBooking)mealServiceImpl.cancelMeal(retrievePnrBookingMock, cancelMealRequestDTOs, null);
//
//		assertEquals(GSON.toJson(expectedRetrievePnrBookingMock), GSON.toJson(actualRetrievePnrBooking));
//	}

	@Test
	public void testCancelMealEmptyPnr() throws BusinessBaseException {
		CancelMealDetailDTO cancelMealRequestDTO = GSON.fromJson("{\"paxIds\":[\"2I\"],\"rloc\":\"VSB55D\",\"segmentId\":\"1\"}", CancelMealDetailDTO.class);
		List<CancelMealDetailDTO> cancelMealRequestDTOs = Lists.newArrayList(cancelMealRequestDTO);
		
		RetrievePnrBooking pnrBooking = new RetrievePnrBooking();
		List<RetrievePnrPassengerSegment> pnrPassengerSegments = new ArrayList<>();
		pnrBooking.setPassengerSegments(pnrPassengerSegments);
		RetrievePnrBooking actualRetrievePnrBooking = mealServiceImpl.cancelMeal(pnrBooking, cancelMealRequestDTOs, null);
		
		assertEquals(null, actualRetrievePnrBooking);
	}
	
	//@Test
	public void testAddMealNormalFlow() throws ExpectedException, SoapFaultException, BusinessBaseException {
		AddMealDetailDTO addMealRequestDTO = GSON.fromJson("{\"companyId\":\"CX\",\"paxMealDetails\":[{\"mealCode\":\"BBML\",\"passengerID\":\"2I\",\"quantity\":1}],\"rloc\":\"VSB55D\",\"segmentId\":\"1\"}", AddMealDetailDTO.class);
		List<AddMealDetailDTO> addMealRequestDTOs = Lists.newArrayList(addMealRequestDTO);
		RetrievePnrBooking actualRetrievePnrBooking = mealServiceImpl.addMeal("ABCDEF", addMealRequestDTOs, null);
		expectedPnrJSONMock ="{\"rloc\":\"VSB55D\",\"officeID\":\"HKGCX0300\",\"passengers\":[{\"passengerID\":\"4\",\"passengerType\":\"ADT\",\"familyName\":\"CHIU\",\"givenName\":\"TOM MR\",\"priTravelDocs\":[],\"secTravelDocs\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"passengerID\":\"2I\",\"parentId\":\"2\",\"passengerType\":\"INF\",\"familyName\":\"CHIU\",\"givenName\":\"LILY\",\"priTravelDocs\":[],\"secTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[]},{\"passengerID\":\"2\",\"passengerType\":\"ADT\",\"familyName\":\"CHIU\",\"givenName\":\"TOMMY\",\"priTravelDocs\":[],\"secTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"passengerID\":\"1\",\"passengerType\":\"ADT\",\"familyName\":\"TEST\",\"givenName\":\"N LAURENCE MR\",\"FQTVInfos\":[{\"companyId\":\"CX\",\"fqtvCompany\":\"CX\",\"fqtvMembershipNumber\":\"1910032120\",\"tierLevel\":\"GO\",\"isTopTier\":true,\"qualifierId\":9}],\"priTravelDocs\":[],\"secTravelDocs\":[],\"desAddresses\":[],\"resAddresses\":[]}],\"segments\":[{\"segmentID\":\"1\",\"originPort\":\"HKG\",\"destPort\":\"TPE\",\"DepartureTime\":{\"pnrTime\":\"2018-05-12 10:00\"},\"ArrivalTime\":{\"pnrTime\":\"2018-05-12 11:55\"},\"marketSegmentNumber\":\"450\",\"marketCompany\":\"CX\",\"subClass\":\"Y\",\"status\":[\"HK\"],\"originTerminal\":\"1\",\"destTerminal\":\"1\",\"airCraftType\":\"773\"},{\"segmentID\":\"2\",\"originPort\":\"TPE\",\"destPort\":\"HKG\",\"DepartureTime\":{\"pnrTime\":\"2018-05-13 21:10\"},\"ArrivalTime\":{\"pnrTime\":\"2018-05-13 22:55\"},\"marketSegmentNumber\":\"483\",\"marketCompany\":\"KA\",\"subClass\":\"Y\",\"status\":[\"HK\"],\"originTerminal\":\"1\",\"destTerminal\":\"1\",\"airCraftType\":\"333\"}],\"passengerSegments\":[{\"etickets\":[\"1602361895962\"],\"passengerId\":\"4\",\"segmentId\":\"1\",\"seat\":{\"seatDetail\":{\"seatNo\":\"41K\",\"seatCharacteristics\":[\"N\",\"W\"],\"paid\":false},\"qulifierId\":43},\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[\"1602361895962\"],\"passengerId\":\"4\",\"segmentId\":\"2\",\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[\"1602361895963\"],\"passengerId\":\"2\",\"segmentId\":\"1\",\"seat\":{\"seatDetail\":{\"seatNo\":\"40E\",\"seatCharacteristics\":[\"N\"],\"paid\":false},\"qulifierId\":625},\"baggageAllowance\":\"40K\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[\"1602361895963\"],\"passengerId\":\"2\",\"segmentId\":\"2\",\"baggageAllowance\":\"40K\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[],\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[\"1602361895964\"],\"passengerId\":\"1\",\"segmentId\":\"1\",\"seat\":{\"seatDetail\":{\"seatNo\":\"40D\",\"seatCharacteristics\":[\"N\",\"A\"],\"paid\":false},\"qulifierId\":622},\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[\"1602361895964\"],\"passengerId\":\"1\",\"segmentId\":\"2\",\"seat\":{\"seatDetail\":{\"seatNo\":\"22D\",\"seatCharacteristics\":[\"N\",\"K\",\"A\"],\"paid\":false},\"qulifierId\":50},\"baggageAllowance\":\"30K\",\"desAddresses\":[],\"resAddresses\":[]},{\"etickets\":[\"1602361895965\"],\"passengerId\":\"2I\",\"segmentId\":\"1\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[]},{\"etickets\":[\"1602361895965\"],\"passengerId\":\"2I\",\"segmentId\":\"2\",\"PriTravelDocs\":[],\"SecTravelDocs\":[],\"othTravelDocs\":[],\"ktns\":[],\"redresses\":[]}],\"ssrList\":[{\"type\":\"RQST\",\"passengerId\":\"4\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"RQST\",\"passengerId\":\"1\",\"segmentId\":\"2\",\"segmentName\":\"SSR\"},{\"type\":\"RQST\",\"passengerId\":\"1\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"RQST\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"INFT\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\",\"freeText\":\"CHIU/LILY 01DEC16\"},{\"type\":\"INFT\",\"passengerId\":\"2\",\"segmentId\":\"2\",\"segmentName\":\"SSR\",\"freeText\":\"CHIU/LILY 01DEC16\"},{\"type\":\"FQTV\",\"passengerId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"MEDA\",\"passengerId\":\"4\",\"segmentName\":\"SSR\"},{\"type\":\"LCML\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"LCML\",\"passengerId\":\"1\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"},{\"type\":\"BBML\",\"passengerId\":\"2\",\"segmentId\":\"1\",\"segmentName\":\"SSR\"}],\"ticketList\":[{\"indicator\":\"OK\",\"date\":\"130218\",\"officeId\":\"HKGCX0300\"},{\"indicator\":\"OK\",\"date\":\"130218\",\"officeId\":\"HKGCX0300\"}],\"remarkList\":[]}";
		expectedRetrievePnrBookingMock = GSON.fromJson(expectedPnrJSONMock, RetrievePnrBooking.class);
		assertEquals(GSON.toJson(expectedRetrievePnrBookingMock), GSON.toJson(actualRetrievePnrBooking));
	}

	@Test
	public void testAddMealNoOneAReplyFlow() throws ExpectedException, BusinessBaseException {
		OneaResponse<PNRReply> response = new OneaResponse<>();
		response.setOneAAction(OneAActionEnum.PNR_ADDMULTIELEMENTS_16_1_1A);
		when(oneAWSClient.addMultiElements(anyObject(), anyObject())).thenReturn(response);
		doNothing().when(oneAErrorHandler).parseOneAErrorCode(anyObject(), anyObject(), anyObject(), anyObject());
		
		AddMealDetailDTO addMealRequestDTO = GSON.fromJson("{\"companyId\":\"CX\",\"paxMealDetails\":[{\"mealCode\":\"BBML\",\"passengerID\":\"2I\",\"quantity\":1}],\"rloc\":\"VSB55D\",\"segmentId\":\"1\"}", AddMealDetailDTO.class);
		List<AddMealDetailDTO> addMealRequestDTOs = Lists.newArrayList(addMealRequestDTO);
		when(pnrResponseParser.paserResponse(anyObject())).thenReturn(null);
		RetrievePnrBooking actualRetrievePnrBooking = mealServiceImpl.addMeal("ABCDEF", addMealRequestDTOs, null);
		
		assertEquals(null, actualRetrievePnrBooking);
	}
}
